<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/three.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multiplayer Threejs</title>
    <style>
      body {
        margin: 0;
        overflow: hidden; /* Prevent scrolling when tilting */
      }
      #app {
        width: 100vw;
        height: 100vh;
        position: relative;
      }
      canvas {
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script type="module">
      // Define key states for motion
      const keyStates = {
        w: false,
        a: false,
        s: false,
        d: false,
      };

      // Sensitivity thresholds for acceleration changes
      const tiltThreshold = 1.5; // Adjust sensitivity (m/sÂ²)

      // Function to set key states
      function setKeyState(key, value) {
        if (keyStates[key] !== value) {
          keyStates[key] = value;
          console.log(`${key} is now ${value ? 'pressed' : 'released'}`);
          handleKeyStates(); // Trigger motion updates
        }
      }

      // Motion event handler
      function handleMotion(event) {
        const { accelerationIncludingGravity } = event;
        if (!accelerationIncludingGravity) return;

        const { x, y, z } = accelerationIncludingGravity;

        // Interpret tilt based on accelerometer data
        if (y > tiltThreshold) {
          setKeyState('w', true); // Tilt forward
          setKeyState('s', false);
        } else if (y < -tiltThreshold) {
          setKeyState('s', true); // Tilt backward
          setKeyState('w', false);
        } else {
          setKeyState('w', false);
          setKeyState('s', false);
        }

        if (x > tiltThreshold) {
          setKeyState('d', true); // Tilt right
          setKeyState('a', false);
        } else if (x < -tiltThreshold) {
          setKeyState('a', true); // Tilt left
          setKeyState('d', false);
        } else {
          setKeyState('a', false);
          setKeyState('d', false);
        }
      }

      // Attach motion event listener
      if (window.DeviceMotionEvent) {
        window.addEventListener('devicemotion', handleMotion);
      } else {
        console.error('DeviceMotionEvent is not supported on this device.');
      }

      // WASD logic (example implementation; replace with your existing function)
      function handleKeyStates() {
        // Example WASD handling logic
        if (keyStates['w']) console.log('Move Forward');
        if (keyStates['a']) console.log('Move Left');
        if (keyStates['s']) console.log('Move Backward');
        if (keyStates['d']) console.log('Move Right');
      }

    </script>
    <script type="module" src="/src/app.js"></script>
  </body>
</html>

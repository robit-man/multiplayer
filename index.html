<!DOCTYPE html>
<html>
<head>
      <link rel="icon" type="image/svg+xml" href="/three.svg" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multiplayer Threejs</title>
</head>
<body>
    <h1>Device Motion Example</h1>
    <p id="acceleration">Acceleration Data: Not available</p>
    <p id="accelerationIncludingGravity">Acceleration (Including Gravity): Not available</p>
    <p id="rotationRate">Rotation Rate: Not available</p>
    <p id="interval">Interval: Not available</p>
    <p id="fallback">Fallback Status: Using alternative controls.</p>

    <script>
        function initDeviceMotion() {
            if ('DeviceMotionEvent' in window) {
                if (typeof DeviceMotionEvent.requestPermission === 'function') {
                    // Request permission on iOS
                    DeviceMotionEvent.requestPermission()
                        .then(permissionState => {
                            if (permissionState === 'granted') {
                                enableDeviceMotion();
                            } else {
                                console.log('Device Motion permission denied. Falling back to alternative controls.');
                                showFallbackMessage();
                                enableFallbackControls();
                            }
                        })
                        .catch(error => {
                            console.error('Error requesting Device Motion permission:', error);
                            showFallbackMessage();
                            enableFallbackControls();
                        });
                } else {
                    // Non-iOS browsers
                    enableDeviceMotion();
                }
            } else {
                console.log('Device Motion not supported. Falling back to alternative controls.');
                showFallbackMessage();
                enableFallbackControls();
            }
        }

        function enableDeviceMotion() {
            console.log('Device Motion enabled.');
            document.getElementById('fallback').innerText = 'Fallback Status: Device Motion enabled.';
            window.addEventListener('devicemotion', handleDeviceMotion);
        }

        function handleDeviceMotion(event) {
            const acc = event.acceleration || {};
            const accG = event.accelerationIncludingGravity || {};
            const rot = event.rotationRate || {};
            const interval = event.interval || 'Unknown';

            document.getElementById('acceleration').innerText = 
                `Acceleration - X: ${acc.x || 0}, Y: ${acc.y || 0}, Z: ${acc.z || 0}`;
            document.getElementById('accelerationIncludingGravity').innerText = 
                `Acceleration (Including Gravity) - X: ${accG.x || 0}, Y: ${accG.y || 0}, Z: ${accG.z || 0}`;
            document.getElementById('rotationRate').innerText = 
                `Rotation Rate - Alpha: ${rot.alpha || 0}, Beta: ${rot.beta || 0}, Gamma: ${rot.gamma || 0}`;
            document.getElementById('interval').innerText = `Interval: ${interval} ms`;
        }

        function enableFallbackControls() {
            console.log('Enabling fallback controls...');
            const status = document.getElementById('fallback');
            status.innerText = 'Fallback Status: Using alternative touch-based controls.';
            document.body.addEventListener('touchstart', handleTouchControls);
        }

        function handleTouchControls(event) {
            const touch = event.touches[0];
            const width = window.innerWidth;
            const height = window.innerHeight;

            if (touch.clientY < height / 2) {
                if (touch.clientX < width / 3) {
                    console.log('Move: Forward + Left');
                } else if (touch.clientX > (2 * width) / 3) {
                    console.log('Move: Forward + Right');
                } else {
                    console.log('Move: Forward');
                }
            } else {
                if (touch.clientX < width / 3) {
                    console.log('Move: Backward + Left');
                } else if (touch.clientX > (2 * width) / 3) {
                    console.log('Move: Backward + Right');
                } else {
                    console.log('Move: Backward');
                }
            }
        }

        function showFallbackMessage() {
            document.getElementById('fallback').innerText = 'Fallback Status: Device Motion not available. Using touch controls.';
        }

        // Initialize
        initDeviceMotion();
    </script>
    <script type="module" src="/src/app.js"></script>
  </body>
</html>
